SOAPI.Ajax={ajax:null,updating:false,requestHashKey:0,requests:[],currentRequest:{},currentHash:null,hashListener:null,loadIndicator:null,timerOn:false,_404_ERROR:'The request URL was unreachable',_AJAX_FAIL:'Unable to create the AJAX request',_EMPTY_URL:'No request provided',request:function(properties){var r={url:null,data:'',dataType:'GET',onSuccess:function(){},onError:function(e){console.log(e);},onUploadEvents:function(){},executeResponse:false,DOMReference:[],showProgress:true};if(isObject(properties)){for(var pName in properties)r[pName]=properties[pName];if(properties.dataType)r.dataType=properties.dataType.toUpperCase();if(r.dataType=='FILE'&&isObject(properties.data)){r.data=properties.data;}else  if(isObject(r.data)){r.data='';for(var key in properties.data)r.data+=key+'='+properties.data[key]+'&';}this.currentRequest=r;this.make();}},make:function(){try{this.ajax=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");if(this.currentRequest.url==null)throw this._EMPTY_URL;if(!this.ajax)throw this._AJAX_FAIL;var obj=this;this.ajax.onreadystatechange=function(){return obj.xhrProcessor();};this.updating=new Date();if(this.currentRequest.dataType=="POST"){var url=this.currentRequest.url+'?'+this.updating.getTime();this.ajax.open("POST",url,true);this.ajax.setRequestHeader("X-Requested-With","XMLHttpRequest");this.ajax.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.ajax.send(this.currentRequest.data);}else  if(this.currentRequest.dataType=="FILE"){var url=this.currentRequest.url+this.updating.getTime();this.ajax.upload.onprogress=this.ajax.upload.onload=this.ajax.upload.onerror=this.currentRequest.onUploadEvents;this.ajax.open("POST",url,true);this.ajax.setRequestHeader("X-Requested-With","XMLHttpRequest");this.ajax.setRequestHeader("Content-Type",this.currentRequest.data.type);this.ajax.setRequestHeader("Content-Length",this.currentRequest.data.fileSize);this.ajax.send(this.currentRequest.data);}else {var url=this.currentRequest.url+'?'+this.currentRequest.data+this.updating.getTime();this.ajax.open("GET",url,true);this.ajax.setRequestHeader("X-Requested-With","XMLHttpRequest");this.ajax.send(null);}}catch(e){this.currentRequest.onError(e);return false;}return true;},xhrProcessor:function(){this.showHideLoadIndicator(true);if(this.ajax.readyState!=4)return;if(this.ajax.responseText!=''){var data=eval("("+this.ajax.responseText+")");this.ajax=null;if(this.currentRequest.executeResponse){var object=this.currentRequest.DOMReference;eval(data.command);}else {this.currentRequest.onSuccess(data);}this.updating=false;}this.showHideLoadIndicator(false);return;},showHideLoadIndicator:function(show){if(!this.loadIndicator){this.loadIndicator=SOAPI.createElement({parent:document.body,attributes:{id:'loadIndicator'}});}if(show&&this.currentRequest.showProgress){if(!this.timerOn){var obj=this;this.waitForLoad=setTimeout(function(){obj.loadIndicator.show();},2500);this.timerOn=true;}}else  if(this.timerOn){clearTimeout(this.waitForLoad);this.timerOn=false;this.loadIndicator.hide();}}};